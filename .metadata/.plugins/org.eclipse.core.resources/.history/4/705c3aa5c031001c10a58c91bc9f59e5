package com.pmg.controller;


import java.util.List;

import javax.inject.Inject;
import javax.servlet.http.HttpSession;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.pmg.domain.Criteria;
import com.pmg.domain.PageMaker;
import com.pmg.domain.UserVO;
import com.pmg.service.UserService;


/**
 * Handles requests for the application home page.
 */

@CrossOrigin(origins = "*")
@RestController
public class HomeController {
	
		private static final Logger logger = LoggerFactory.getLogger(HomeController.class);
	    
		@Inject
		private UserService userService;
		/**
		 * Simply selects the home view to render by returning its name.
		 */
		
//		@GetMapping(value = "/")
//		public void home(Locale locale, Model model, HttpSession session, HttpServletRequest request) throws Exception {
//					
//			List<UserVO> users  = service2.listAll();
//			
//			String valeu = (String)session.getAttribute("username");
//			System.out.println("들오긴 한다");
//
//			return users;
//		}
		
		@PostMapping(value="/login")
		public UserVO loginUser( @RequestBody UserVO user, HttpSession session) throws Exception {
						
			UserVO userInfo = userService.loginUserRead(user);

			return userInfo;
		}

		@PostMapping(value="/loginChk")
	    public UserVO loginChk( @RequestBody UserVO GetUser) throws Exception{
			
			UserVO ReturnUser = userService.userIdRead(GetUser.getUserId());
			
	        return ReturnUser;

	    }
		

		@PostMapping(value="/userRegister")
	    public UserVO userRegister( @RequestBody UserVO user) throws Exception{
			/*
		    +----+---------+
			| id | grade   |
			+----+---------+
			|  1 | admin   |
			|  2 | normal  |
			|  3 | waiting |
			|  4 | reject  |
			+----+---------+
		 */
		user.setGrade_id(3);
		// 회원등급을 3으로 초기값을 부여해 관리자가 반려 또는 승인을 할 수 있도록 한다. 
		
        return null;

    }
		
		// 개인정보를 이용한 아이디 찾기
		@PostMapping(value="/userIdFind")
	    public List<UserVO> userIdFind( @RequestBody UserVO user) throws Exception{

			List<UserVO> getUserVO = userService.userIdFind(user);
			
//			int count = 0;
//			for(UserVO str : getUserVO){
//			    System.out.println(count + "번째 id는: " + str.getUserId());
//			    count++;
//			}
//			
		    return getUserVO;
    }	
		
		
		
		
		// 개인정보를 이용한 비밀번호 찾기
		@PostMapping(value="/userFindpw")
	    public UserVO userFindpw( @RequestBody UserVO user) throws Exception{

			UserVO getUserVO = userService.userPwFind(user);

		    return getUserVO;
    }	
		
		
		// 비밀번호 조회 id, 원하는 password 값 (update)
		@PostMapping(value="/userPwUpdate")
	    public void userPwUpdate( @RequestBody UserVO user) throws Exception{
			
			userService.userPwUpdate(user);
		   
    }			
		
		
		// 비밀번호 조회 id, 원하는 password 값 (select)
		@PostMapping(value="/userPwSearch")
	    public UserVO userPwSearch( @RequestBody UserVO user) throws Exception{

			UserVO getUserVO = userService.userPwSearch(user);

			return getUserVO;

    }			
		
		
		
		// 유저 정보 조회 (id로 검색)
		@PostMapping(value="/userInfoRead")
	    public UserVO userInfoRead( @RequestBody UserVO user) throws Exception{
			
			UserVO getUserVO = userService.userInfoRead(user.getId());
		  
			return getUserVO;

		   
    }			
		
		// user 정보 update
		@PostMapping(value="/userInfoUpdate")
	    public UserVO userInfoUpdate( @RequestBody UserVO user) throws Exception{
			
			UserVO getUserVO = userService.userInfoUpdate(user);
						
			return getUserVO;

		   
    }				
		
		
		// user 모든정보 조회 [페이징 처리]
		
		@PostMapping(value="/userIdListRead")
	    public List<UserVO> userIdListRead() throws Exception{

			PageMaker page = new PageMaker();
			Criteria cri = new Criteria();
			
			page.setCri(cri);
			page.setTotalCount(userService.userIdListCount());
			System.out.println(page);
			
			UserVO users = userService.userIdListReadTen(cri);
			//List<UserVO> getUserVO = userService.userIdListRead();
			
			return getUserVO;

		   
    }				
		
		// 비밀번호 조회 id, 원하는 password 값 (update)
		@PostMapping(value="/userGradeInsert")
	    public void userGradeInsert( @RequestBody UserVO user) throws Exception{
			userService.userGradeInsert(user);
		}		
		
		
		
		
		
//		@PostMapping(value="/insert")
//		public void insertUser(@RequestBody UserVO user) throws Exception {
//
//			service2.create(user);
//			
		
	    
//		@GetMapping(value = "/")
//		public List<UserVO> home(Locale locale, Model model, HttpSession session, HttpServletRequest request) throws Exception {
//					
//			List<UserVO> users  = service2.listAll();
//			
//			String valeu = (String)session.getAttribute("username");
//			System.out.println("들오긴 한다");
//
//			return users;
//		}
//		
//		@PostMapping(value="/login")
//		public UserVO loginUser( @RequestBody UserVO user2, HttpSession session) throws Exception {
//
//			//System.out.println(user2.getId() +" 이랑 " + user2.getPassword());
//			
//			UserVO user = service2.login(user2);
//			System.out.println(user);
//			if(user == null) {
//				System.out.println(user);
//				return null;
//			}else {
//				
//				session.setAttribute("username", user.getUsername());
//
//				return user;
//
//			}
//		}
//
//		@PostMapping(value="/insert")
//		public void insertUser(@RequestBody UserVO user) throws Exception {
//
//			service2.create(user);
//			
//		}
		
//		@RequestMapping(value = "/delete/{id}", method = RequestMethod.DELETE)
//		public void deleteUser(@PathVariable("id") int id) throws Exception {
//			service2.delete(id);
//			
//		}
//		
//		@RequestMapping(value = "/select/{id}", method = RequestMethod.GET)
//		public UserVO selectUser(@PathVariable("id") int id, HttpSession session) throws Exception {
//			
//			UserVO user	= service2.read(id);
//			
//			System.out.println(session.getAttribute("username"));
//			
//			return user;
//			
//		}
//		
//
//		@RequestMapping(value = "/update/{id}", method = RequestMethod.PUT)
//		public void updateUser(@PathVariable int id, @RequestBody UserVO user) throws Exception {
//			
//			service2.update(user);
//						
//		}
//		
//		
//	    
//	    @RequestMapping(value="/create", method=RequestMethod.GET)
//	    public void createGET(BoardVO board, Model model) throws Exception{
//	        System.out.println("/create 입니다. GET방식");
//	        
//	    }
//	    
//	    @RequestMapping(value = "/create", method=RequestMethod.POST )
//	    public String createPOST(BoardVO board, Model model) throws Exception{
//	        System.out.println("/board/create POST방식 입니다.");
//	        System.out.println(board.toString());
//	        
//	        service.create(board);
//	        model.addAttribute("result", "성공");
//	        
//	        return "redirect:/";
//	    }
//	    
//	    @RequestMapping(value = "/read", method=RequestMethod.GET )
//	    public void read(@RequestParam("b_no")int b_no, Model model, 
//	    		HttpServletRequest request) throws Exception{
//	       
//			
//	    	model.addAttribute(service.read(b_no));
//
//	    }
	    
//	    @RequestMapping(value = "/delete", method=RequestMethod.POST )
//	    public String delete(@RequestParam("b_no")int b_no, Model model) throws Exception{
//	        
//	        service.delete(b_no);
//	        //model.addAttribute("result", "delete 성공");
//	        System.out.println("delete 성공");
//	        return "redirect:/";
//	    }
//	    
	    
//	    @RequestMapping(value = "/modify", method=RequestMethod.GET )
//	    public void modify(@RequestParam("b_no")int b_no, Model model) throws Exception{
//	       
//	    	model.addAttribute(service.read(b_no));
//
//	    }
//	
//	    @RequestMapping(value = "/modify", method=RequestMethod.POST )
//	    public String modifyPOST(BoardVO board, Model model) throws Exception{
//	       
//	    	System.out.println(board.getB_no());
//	    	
//	    	service.update(board);
//	    	
//	        model.addAttribute("result", "성공2222");
//	        
//	        return "redirect:/";
//	    }
//	    
//
//		public static <T> List<Map<String, Object>> convertListToMap(Collection<T> target) {
//			List<Map<String, Object>> resultList = new ArrayList<Map<String, Object>>();
//			for (T element : target) {
//				Map<String,Object> resultMap = new HashMap<String,Object>();
//				Field[] fieldList = element.getClass().getDeclaredFields();
//				if (fieldList != null && fieldList.length > 0) {
//					try {
//						for (int i = 0; i < fieldList.length; i++) {
//							String curInsName = fieldList[i].getName();
//							Field field = element.getClass().getDeclaredField(curInsName);
//							field.setAccessible(true);
//							Object targetValue = field.get(element);
//							resultMap.put(curInsName, targetValue);
//						}
//						resultList.add(resultMap);
//						
//					} catch (Exception e) {
//						// TODO Auto-generated catch block
//						e.printStackTrace();
//					}
//				}
//			}
//			return resultList;
//		}
}
